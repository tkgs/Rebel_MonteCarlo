{% extends "layout.html" %}
{% block content %}
    <div class="content-section">
        <form method="POST" action="">
            {{ form.hidden_tag() }}
            <h2><a href="{{ url_for('about') }}#input">Inputs da simulação</a></h2>
            <fieldset class="form-group">
                <div class="form-group">
                        {{ form.num_sim.label(class="form-control-label form-control-sm align-middle col-2") }}
                        {% if form.num_sim.errors %}
                            {{ form.num_sim(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.num_sim.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                    {% else %}
                        {{ form.num_sim(class="form-control-inline form-control-sm", value=input[4]) }}
                    {% endif %}
                </div>
                <br>
                <legend class=""><a href="{{ url_for('about') }}#prazo">Prazo da dívida (meses)</a></legend>
                <div class="form-group">
                        {{ form.prazo_min.label(class="form-control-label form-control-sm col-2") }}
                        {% if form.prazo_min.errors %}
                            {{ form.prazo_min(class="form-control form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.prazo_min.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                    {% else %}
                        {{ form.prazo_min(class="form-control-inline form-control-sm", value=input[0][0]) }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.prazo_med.label(class="form-control-label form-control-sm col-2") }}
                    {% if form.prazo_med.errors %}
                        {{ form.prazo_med(class="form-control form-control-sm is-invalid") }}
                        <div class="invalid-feedback">
                            {% for error in form.prazo_med.errors %}
                            <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form.prazo_med(class="form-control-inline form-control-sm", value=input[0][1]) }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.prazo_max.label(class="form-control-label form-control-sm col-2") }}
                    {% if form.prazo_max.errors %}
                    {{ form.prazo_max(class="form-control form-control-sm is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.prazo_max.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                        {{ form.prazo_max(class="form-control-inline form-control-sm", value=input[0][2]) }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.prazo_std.label(class="form-control-label form-control-sm col-2") }}
                    {% if form.prazo_std.errors %}
                    {{ form.prazo_std(class="form-control-inline form-control-sm is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.prazo_std.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                        {{ form.prazo_std(class="form-control-inline form-control-sm", value=input[0][3]) }}
                    {% endif %}
                </div>
            </fieldset>
            <br>
            <fieldset class="form-group">
                <legend class=""><a href="{{ url_for('about') }}#juros">Taxa de juros (% a.m.)</a></legend>
                <div class="form-group">
                        {{ form.juros_min.label(class="form-control-label form-control-sm col-2") }}
                        {% if form.juros_min.errors %}
                            {{ form.juros_min(class="form-control-inline form-control-lg is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.juros_min.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                    {% else %}
                        {{ form.juros_min(class="form-control-inline form-control-sm", value=input[1][0]) }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.juros_med.label(class="form-control-label form-control-sm col-2") }}
                    {% if form.juros_med.errors %}
                    {{ form.juros_med(class="form-control-inline form-control-sm is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.juros_med.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form.juros_med(class="form-control-inline form-control-sm", value=input[1][1]) }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.juros_max.label(class="form-control-label form-control-sm col-2") }}
                    {% if form.juros_max.errors %}
                    {{ form.juros_max(class="form-control-inline form-control-sm is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.juros_max.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form.juros_max(class="form-control-inline form-control-sm", value=input[1][2]) }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.juros_std.label(class="form-control-label form-control-sm col-2") }}
                    {% if form.juros_std.errors %}
                    {{ form.juros_std(class="form-control-inline form-control-sm is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.juros_std.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form.juros_std(class="form-control-inline form-control-sm", value=input[1][3]) }}
                    {% endif %}
                </div>
            </fieldset>
            <br>
            <fieldset class="form-group">
                <legend class=""><a href="{{ url_for('about') }}#divida">Valor da dívida (R$)</a></legend>
                <div class="form-group">
                        {{ form.divida_min.label(class="form-control-label form-control-sm col-2") }}
                        {% if form.divida_min.errors %}
                            {{ form.divida_min(class="form-control-inline form-control-lg is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.divida_min.errors %}
                                <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                    {% else %}
                        {{ form.divida_min(class="form-control-inline form-control-sm", value=input[2][0]) }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.divida_med.label(class="form-control-label form-control-sm col-2") }}
                    {% if form.divida_med.errors %}
                    {{ form.divida_med(class="form-control-inline form-control-sm is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.divida_med.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form.divida_med(class="form-control-inline form-control-sm", value=input[2][1]) }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.divida_max.label(class="form-control-label form-control-sm col-2") }}
                    {% if form.divida_max.errors %}
                    {{ form.divida_max(class="form-control-inline form-control-sm is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.divida_max.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form.divida_max(class="form-control-inline form-control-sm", value=input[2][2]) }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.divida_std.label(class="form-control-label form-control-sm col-2") }}
                    {% if form.divida_std.errors %}
                    {{ form.divida_std(class="form-control-inline form-control-sm is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.divida_std.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% else %}
                    {{ form.divida_std(class="form-control-inline form-control-sm", value=input[2][3]) }}
                    {% endif %}
                </div>
            </fieldset>
            <br>
            <fieldset class="form-group">
                <legend class=""><a href="{{ url_for('about') }}#curva_default_input">Curva de default</a></legend>
                <div class="form-group">
                        {{ form.curva_default.label(class="form-control-label form-control-sm col-2") }}
                        {% if form.curva_default.errors %}
                            {{ form.curva_default(class="form-control-inline form-control-sm is-invalid") }}
                            <div class="invalid-feedback">
                                {% for error in form.curva_default.errors %}
                                    <span>{{ error }}</span>
                                {% endfor %}
                            </div>
                    {% else %}
                        {{ form.curva_default(class="form-control-inline form-control-sm col-9", value=input[3]) }}
                    {% endif %}
                </div>
                <small id="curva_defaultHelpBlock" class="form-text text-muted mx-2">
                    Digite os valores de probabilidade de default para cada mês, em %. Os valores devem ser separados por vírgula.
                </small>
            </fieldset>
            <div class="form-group mt-3">
                {{ form.submit(class="btn btn-outline-info btn-lg") }}
            </div>
        </form>
    </div>
    {% if output %}
        <div class="content-section about" id="output">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            <h2><a href="{{ url_for('about') }}#output">Outputs da simulação</a></h2>
            <h5><a href="{{ url_for('about')}}#irr">IRR (com default):</a> {{ "{:.2f} %a.m.".format(output[0][0]*100) }}
            <br><a href="{{ url_for('about')}}#irr_semdefault">IRR (sem default):</a> {{ "{:.2f} %a.m.".format(output[0][1]*100) }}
            <br><a href="{{ url_for('about')}}#duration">Duration:</a> {{ "{:.1f} meses".format(output[5]) }}
            {% if output[4] > 0 %}
                <br><a href="{{ url_for('about')}}#payback">Payback:</a> {{ "{:.1f} meses".format(output[4]) }}
            {% else %}
                <br><a href="{{ url_for('about')}}#payback">Payback:</a> N/A
            {% endif %}
            <br><a href="{{ url_for('about')}}#dv01">DV01:</a> R$ {{ "{:,.0f}".format(output[6]) }}
            <br><a href="{{ url_for('about')}}#total_dividas">Total dívidas:</a> R$ {{ "{:,.0f}".format(output[2]) }}
            <br><a href="{{ url_for('about')}}#dv01">Net cashflows:</a> R$ {{ "{:,.0f}".format(output[3]) }}</h5>
            <h4><a href="{{ url_for('about') }}#graficos">Histogramas e estatísticas</a></h4>
            <img src="data:image/png;base64,{{ output[7] }}" alt="output simulacao">
            <br><br>
            <small><a href="{{ url_for('about')}}#curva_default">Curva de default considerada</a> (mês[prob]): {{ output[1] }}</small>
            <script>
                document.getElementById('output').scrollIntoView();
            </script>
        </div>
    {% endif %}

{% endblock content %}